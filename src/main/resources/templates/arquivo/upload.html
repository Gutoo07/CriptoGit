<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
	<head>
	  <meta charset="UTF-8">
	  <meta name="viewport" content="width=device-width, initial-scale=1.0">
	  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
	  <title>Trabalho Engenharia</title>
	  <style>
	    body {
	      font-family: Arial, sans-serif;
	      margin: 0;
	      padding: 0;
	      background-color: #f6f8fa;
	    }

	    /* Barra de navegação superior */
	    .navbar {
	      background-color: #24292f;
	      color: white;
	      padding: 10px 20px;
	      display: flex;
	      justify-content: space-between;
	      align-items: center;
	      position: relative;
	    }

	    .navbar .logo {
	      font-size: 24px;
	      font-weight: bold;
	    }

	    .navbar .search-bar {
	      display: flex;
	      justify-content: center;
	      align-items: center;
	      flex: 1;
	      margin: 0 20px;
	    }

	    .navbar .search-bar input {
	      padding: 5px 15px;
	      border: 1px solid #ccc;
	      border-radius: 20px;
	      width: 400px;
	    }

	    /* Botão de usuário/login */
	    .navbar .login-btn {
	      background-color: #2c974b;
	      color: white;
	      padding: 8px 16px;
	      border-radius: 20px;
	      text-decoration: none;
	      transition: background-color 0.3s;
	    }

	    .navbar .login-btn:hover {
	      background-color: #238a3b;
	    }

	    /* Sidebar */
	    .sidebar {
	      width: 250px;
	      background-color: #24292f;
	      color: white;
	      height: 100vh;
	      position: fixed;
	      top: 0;
	      left: 0;
	      padding-top: 20px;
	      display: flex;
	      flex-direction: column;
	    }

	    .sidebar a {
	      color: white;
	      text-decoration: none;
	      padding: 12px 20px;
	      border-bottom: 1px solid #444;
	      transition: background-color 0.3s;
	    }

	    .sidebar a:hover {
	      background-color: #444;
	    }

	    /* Conteúdo principal */
	    .content {
	      margin-left: 270px;
	      padding: 20px;
	    }

	    .content .title {
	      font-size: 28px;
	      margin-bottom: 20px;
	    }

	    /* Tabela de repositórios */
	    .repo-table {
	      width: 100%;
	      border-collapse: collapse;
	    }

	    .repo-table th, .repo-table td {
	      padding: 12px 15px;
	      border: 1px solid #ddd;
	      text-align: left;
	    }

	    .repo-table th {
	      background-color: #24292f;
	      color: white;
	    }

	    .repo-table tr:nth-child(even) {
	      background-color: #f9f9f9;
	    }

	    .repo-table tr:hover {
	      background-color: #f1f1f1;
	    }

	    /* Botão de ação para cada repositório */
	    .view-repo-btn {
	      background-color: #2c974b;
	      color: white;
	      padding: 8px 16px;
	      border-radius: 6px;
	      text-decoration: none;
	      transition: background-color 0.3s;
	    }

	    .view-repo-btn:hover {
	      background-color: #238a3b;
	    }

	    /* Estilo para a tela de detalhes do repositório */
	    .repo-details {
	      margin-top: 30px;
	    }

	    .repo-details .version-select {
	      margin-bottom: 20px;
	    }

	    .repo-details .file-list {
	      list-style: none;
	      padding-left: 0;
	    }

	    .repo-details .file-list li {
	      padding: 8px;
	      border: 1px solid #ddd;
	      margin-bottom: 10px;
	      background-color: #f9f9f9;
	    }

	    .repo-details .file-list li:hover {
	      background-color: #f1f1f1;
	    }

	    .repo-details .file-list li a {
	      text-decoration: none;
	      color: #24292f;
	    }
	  </style>
	</head>
	<body>
	    <!-- Barra de navegação -->
	    <div class="navbar">
	        <div class="logo">nome do software</div>
	        <div class="search-bar">
	            <input type="text" placeholder="Pesquisar repositórios...">
	        </div>
	        <a href="#" class="login-btn">Login</a>
	    </div>

	    <!-- Sidebar -->
	    <div class="sidebar">
	        <a href="#">Projetos</a>
	        <a href="#">Colaboradores</a>
	    </div>

	    <!-- Conteúdo principal -->
	    <div class="content" id="vue-app">
	        <div class="title"><span>Repositório: </span><span th:text="${repositorio.nome}"></span></div>

	        <div class="repo-details">
	            <form th:action="@{/arquivo/uploadArquivo}" method="post" enctype="multipart/form-data"  th:object="${repositorio}">
	  
					<!-- Id Do Repositorio -->
					<input type="hidden" id="rep_id" name="rep_id" th:value="${repositorio.id}">
					
					
					<!-- Nome do Commit -->
	                <div style="margin-bottom: 20px;">
	                    <label for="msg" style="font-weight: bold;">Nome do Commit:</label><br>
	                    <input type="text" id="msg" name="msg" v-model="msg" @change="validarMsg" placeholder="Digite a mensagem do commit..." style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; margin-top: 5px;">
	                </div>

	                <!-- Upload de múltiplos arquivos -->
	                <div style="margin-bottom: 20px;">
	                    <label for="arquivo" style="font-weight: bold;">Selecionar arquivos:</label><br>
	                    <input type="file" id="arquivo" name="arquivo" multiple style="margin-top: 5px;" webkitdirectory @change="validarArquivos">
	                    <div v-if="erroArquivo" style="color: red; font-size: 14px; margin-top: 5px;">
	                        {{ erroArquivo }}
	                    </div>
	                </div>

	                <!-- URL do Servidor -->
	                <div style="margin-bottom: 20px;">
	                    <label for="serverUrl" style="font-weight: bold;">URL do Servidor:</label><br>
	                    <input type="url" id="serverUrl" v-model="serverUrl" placeholder="https://exemplo.com/api/upload" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; margin-top: 5px;">
	                </div>

	                <!-- Botões de commit -->
	                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
	                    <button type="button" @click="fazerCommit" style="background-color: #2c974b; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer;">
	                        Fazer Commit (Local)
	                    </button>
	                    <button type="button" @click="fazerCommitToServer" style="background-color: #0366d6; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer;">
	                        Enviar para Servidor
	                    </button>
	                </div>
	            </form>
	        </div>
	    </div>
	</body>
	</html>

	<script>
		const { createApp, ref, onMounted } = Vue;
		createApp({
			setup() {
				const msg = ref('');
				const serverUrl = ref('');
				const erroArquivo = ref('');
				
				const validarArquivos = (event) => {
					const arquivos = event.target.files;					
					if (arquivos || arquivos.length !== 0) {
						erroArquivo.value = '';					
					}					
				};
				
				const validarMsg = () => {
					if (msg.value.trim() !== '') {
						erroArquivo.value = '';
					}
				};
				
				const fazerCommit = () => {					
					// Validar se arquivos foram selecionados
					const inputArquivo = document.getElementById('arquivo');
					if (!inputArquivo.files || inputArquivo.files.length === 0) {
						erroArquivo.value = 'Selecione pelo menos um arquivo antes de fazer o commit.';
						return;
					}
					
					// Validar se a mensagem do commit foi preenchida
					if (!msg.value.trim()) {
						erroArquivo.value = 'Digite uma mensagem para o commit.';
						return;
					}
					// Se tudo estiver válido, submeter o formulário
					erroArquivo.value = '';
					document.querySelector('form').submit();
				};

				const fazerCommitToServer = async () => {
					// Validar se arquivos foram selecionados
					const inputArquivo = document.getElementById('arquivo');
					if (!inputArquivo.files || inputArquivo.files.length === 0) {
						erroArquivo.value = 'Selecione pelo menos um arquivo antes de fazer o commit.';
						return;
					}
					
					// Validar se a mensagem do commit foi preenchida
					if (!msg.value.trim()) {
						erroArquivo.value = 'Digite uma mensagem para o commit.';
						return;
					}
					
					// Validar se a URL do servidor foi preenchida
					if (!serverUrl.value.trim()) {
						erroArquivo.value = 'Digite a URL do servidor.';
						return;
					}
					
					// Se tudo estiver válido, enviar via AJAX
					erroArquivo.value = '';
					
					try {
						// Criar FormData para enviar arquivos
						const formData = new FormData();
						
						// Adicionar arquivos
						for (let i = 0; i < inputArquivo.files.length; i++) {
							formData.append('arquivo', inputArquivo.files[i]);
						}
						
						// Adicionar outros dados
						formData.append('msg', msg.value);
						formData.append('rep_id', document.getElementById('rep_id').value);
						formData.append('server_url', serverUrl.value);
						
						// Enviar requisição
						const response = await fetch('/arquivo/uploadToServer', {
							method: 'POST',
							body: formData
						});
						
						const responseText = await response.text();
						
						if (response.ok) {
							// Sucesso
							erroArquivo.value = 'Arquivos enviados com sucesso para o servidor!';
							erroArquivo.value = responseText;
							// Limpar campos
							msg.value = '';
							inputArquivo.value = '';
						} else {
							erroArquivo.value = 'Erro: ' + responseText;
						}
					} catch (error) {
						erroArquivo.value = 'Erro de conexão: ' + error.message;
					}
				};
				
				return {
					erroArquivo,
					msg,
					serverUrl,
					validarArquivos,
					validarMsg,
					fazerCommit,
					fazerCommitToServer
				};
			}
		}).mount('#vue-app');
	</script>